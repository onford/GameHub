<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="./../css/mangerPage.css">
    <link rel="stylesheet" href="./../../src/vendor/bootstrap/css/bootstrap.min.css">
</head>

<style>
    * {
        margin: 0;
        padding: 0;
    }

    .my-flex-container {
        display: flex;
    }

    .my-main {
        padding: 20px;
        width: 85%;
    }

    .my-lefter {
        height: 100vh;
        width: 15%;
        background-color: rgb(58, 58, 58);
    }

    .my-option-table {
        width: 100%;
    }

    .my-option-table:hover {
        background-color: #000000;
        cursor: pointer;
    }

    /* .my-option-table:active {
        background-color: #bbb;
    } */

    .my-option {
        text-align: center;
        font-size: 20px;
        padding: 15px;
        color: white;
        margin: 0;
    }

    .my-main-header-title {
        font-size: 30px;
    }

    .my-view-option-table {
        margin-right: 40px;
    }

    .my-view-option-table:hover {
        cursor: pointer;
        border-bottom: 2px solid rgb(0, 153, 255);
    }

    .my-view-option {
        margin: 0;
    }

    table {
        margin-top: 10px;
        width: 100%;
    }

    td {
        border: 1px solid #ccc;
        text-align: center;
        padding: 10px;
    }

    a {
        text-decoration: none;
    }

    .my-reject {
        color: rgb(255, 75, 0);
    }

    .my-accpet {
        color: rgb(0, 150, 150);
    }

    .my-not-read {
        color: #00A1D6;
    }

    .my-main-bottom {
        width: 100%;
    }

    .my-page-btn {
        border: 1px solid #d7dde4;
        border-radius: 5%;
        padding: 0 10px;
        color: #657180;
        background-color: white;
    }

    .my-page-btn:hover {
        border-color: #00A1D6;
        color: #00A1D6;
    }

    .my-page-navigation-table {
        margin: 20px auto;
    }
</style>

<body>
    <div class="my-flex-container">
        <div class="my-lefter">
            <div class="my-option-table" style="background-color: #000000;">
                <p class="my-option" onclick="jumpHandle1(event);">
                    代码审核
                </p>
            </div>
            <div class="my-option-table">
                <p class="my-option" onclick="jumpHandle2(event);">
                    账号管理
                </p>
            </div>
        </div>
        <div class="my-main">
            <div class="my-main-header">
                <p class="my-main-header-title">
                    代码审核
                </p>
                <hr>
                <div class="my-flex-container">
                    <div class="my-view-option-table" style="border-bottom: 2px solid rgb(0, 153, 255);">
                        <p class="my-view-option">全部</p>
                    </div>
                    <div class="my-view-option-table">
                        <p class="my-view-option">待审核 </p>
                    </div>
                    <div class="my-view-option-table">
                        <p class="my-view-option">已通过 </p>
                    </div>
                    <div class="my-view-option-table">
                        <p class="my-view-option">已驳回 </p>
                    </div>
                </div>
            </div>
            <div class="my-main-body">
                <table class="message_table">
                    <!-- <thead>
                        <tr>
                            <td>
                                序号
                            </td>
                            <td>
                                用户名
                            </td>
                            <td>
                                上载时间
                            </td>
                            <td>
                                状态
                            </td>
                            <td>
                                操作
                            </td>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>
                                1
                            </td>
                            <td>
                                Njaso
                            </td>
                            <td>
                                2024.11.2 17:32:53
                            </td>
                            <td class="my-accpet">
                                已通过
                            </td>
                            <td>
                                <a href="#">删除</a>
                                <a href="#">通过</a>
                                <a href="#">下载压缩包</a>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                2
                            </td>
                            <td>
                                Tommy
                            </td>
                            <td>
                                2024.11.2 17:41:53
                            </td>
                            <td class="my-not-read">
                                待审核
                            </td>
                            <td>
                                <a href="#">删除</a>
                                <a href="#">通过</a>
                                <a href="#">下载压缩包</a>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                2
                            </td>
                            <td>
                                Sunny
                            </td>
                            <td>
                                2019.12.12 10:41:53
                            </td>
                            <td class="my-reject">
                                已驳回
                            </td>
                            <td>
                                <a class='my-operation' href="#">删除</a>
                                <a class='my-operation' href="#">通过</a>
                                <a class='my-operation' href="#">下载压缩包</a>
                            </td> -->
                    <!-- </tr> -->
                    <!-- 这里插入作品数据 -->
                    <!-- </tbody> -->
                </table>
            </div>
            <div class="my-main-bottom my-flex-container">
                <div class="my-page-navigation-table">
                    <!-- <button class="my-page-btn">上一页</button>
                    <button class="my-page-btn" style="background-color: #00A1D6; color:white;">1</button>
                    <button class="my-page-btn">2</button>
                    <button class="my-page-btn">3</button> -->
                    <!-- <button class="my-page-btn my-omit-btn">...</button> -->
                    <!-- <span style="font-size: 20px; color: #aaa;">...</span>
                    <button class="my-page-btn">114514</button>
                    <button class="my-page-btn">下一页</button> -->
                </div>
            </div>
        </div>
    </div>
</body>

<script>
    Array.from(document.getElementsByClassName('my-view-option-table')).forEach(element => {
        element.addEventListener('click', function () {
            this.style.borderBottom = '2px solid rgb(0, 153, 255)'
            for (var e of document.getElementsByClassName('my-view-option-table')) {
                if (e !== this) {
                    e.style.borderBottom = 'none'
                }
            }
        })
    })

    function jumpHandle1(event) {
        event.preventDefault();
        location.href = './codeReview.html';
    }

    function jumpHandle2(event) {
        event.preventDefault();
        localStorage.setItem("search_box_text", "");
        location.href = './accountManager_root.html';
    }

    function generateEmptyTable(msg) {
        var message_table = document.getElementsByClassName("message_table")[0];
        console.log(message_table);
        clearTable();
        var thead = document.createElement("thead");
        var new_tr = document.createElement("tr");
        var new_td = document.createElement("td");
        new_td.classList.add("my-only-td");
        new_td.innerHTML = msg;
        new_tr.appendChild(new_td);
        thead.appendChild(new_tr);
        message_table.appendChild(thead);
    }

    function clearTable() {
        var message_table = document.getElementsByClassName("message_table")[0];
        var children = message_table.childNodes;
        while (children && children.length > 0) {
            message_table.removeChild(children[0]);
        }
    }

    function get_username_and_status_by_receive_id(receive_id) {
        const select_username_and_status_by_receive_id_api = "./../../backend/api/select_username_and_status_by_receive_id_api.php";
        var form_data = new FormData();
        form_data.append("receive_id", receive_id);
        fetch(select_username_and_status_by_receive_id_api, {
            method: "POST",
            body: form_data
        })
            .then(response => response.json())
            .then(data => {
                if (data.code != 0) {
                    alert(data.msg);
                    return [null, null];
                }
                else {
                    console.log("用账号名查询用户名成功");
                    console.log("receive_id: " + receive_id);
                    console.log(data.data);
                    return [data.data.username, data.data.status];
                }
            })
            .catch(error => console.error(error))
        return [null, null];
    }

    function generateMessageTable(timestampss, statuss, usernames, newgame_names, versions) {
        clearTable();
        var message_table = document.getElementsByClassName("message_table")[0];
        var len = timestampss.length;

        var const_thead = document.createElement("thead");
        message_table.appendChild(const_thead);

        var const_tr = document.createElement("tr");
        var const_id_td = document.createElement("td");
        var const_username_td = document.createElement("td");
        var const_gamename_td = document.createElement("td");
        var const_version_td = document.createElement("td");
        var const_timestamps_td = document.createElement("td");
        var const_status_td = document.createElement("td");
        var const_operation_td = document.createElement("td");

        const_id_td.innerHTML = "序号";
        const_username_td.innerHTML = "用户名";
        const_gamename_td.innerHTML = "游戏名";
        const_version_td.innerHTML = "版本号";
        const_timestamps_td.innerHTML = "上载时间";
        const_status_td.innerHTML = "状态";
        const_operation_td.innerHTML = "操作";

        const_tr.appendChild(const_id_td);
        const_tr.appendChild(const_username_td);
        const_tr.appendChild(const_gamename_td);
        const_tr.appendChild(const_version_td);
        const_tr.appendChild(const_timestamps_td);
        const_tr.appendChild(const_status_td);
        const_tr.appendChild(const_operation_td);

        const_thead.appendChild(const_tr);
        var const_tbody = document.createElement("tbody");

        for (var i = 0; i < len; i++) {
            var new_tr = document.createElement("tr");
            var new_id_td = document.createElement("td");
            var new_username_td = document.createElement("td");
            var new_gamename_td = document.createElement("td");
            var new_version_td = document.createElement("td");
            var new_timestamps_td = document.createElement("td");
            var new_status_td = document.createElement("td"); //这个状态不是已读未读
            var new_operation_td = document.createElement("td");

            var username = "";
            var status = "";


            // //向接口获取用户名和游戏审核状态
            // const select_newgame_list_info_by_newgame_id_api = "./../../backend/api/select_newgame_list_info_by_newgame_id_api.php";
            // var form_data = new FormData();
            // form_data.append("recognize_id", recognize_ids[i]);
            // fetch(select_newgame_list_info_by_newgame_id_api, {
            //     method: "POST",
            //     body: form_data
            // })
            //     .then(response => response.json())
            //     .then(data => {
            //         if (data.code != 0) {
            //             alert(data.msg);
            //         }
            //         else {
            //             console.log("查询游戏资讯成功");
            //             console.log(data.data);
            //             new_username_td.innerHTML = data.data.username; //不放在这里又会被异步优化掉,username直接为空
            //             new_gamename_td.innerHTML = data.data.newgame_name;
            //             new_version_td.innerHTML = data.data.version + 1 + ".0";
            //             if (data.data.status == 0) {
            //                 new_status_td.innerHTML = "待审核";
            //                 new_status_td.classList.add("my-not-read");
            //             }
            //             else if (data.data.status == 1) {
            //                 new_status_td.innerHTML = "已通过";
            //                 new_status_td.classList.add("my-accept");
            //             }
            //             else if (data.data.status == 2) {
            //                 new_status_id.innerHTML = "已驳回";
            //                 new_status_td.classList.add("my-reject");
            //             }
            //         }
            //     })
            //     .catch(error => console.error(error))

            new_id_td.innerHTML = i + 1;
            new_username_td.innerHTML = usernames[i];
            new_gamename_td.innerHTML = newgame_names[i];
            new_timestamps_td.innerHTML = timestampss[i];
            new_version_td.innerHTML = versions[i];
            new_timestamps_td.innerHTML = timestampss[i];

            // 状态列特判一下
            if (statuss[i] == 0) {
                new_status_td.innerHTML = "待审核";
                new_status_td.classList.add("my-not-read");
            } else if (statuss[i] == 1) {
                new_status_td.innerHTML = "已通过";
                new_status_td.classList.add("my-accept");
            } else {
                new_status_td.innerHTML = "已驳回";
                new_status_td.classList.add("my-reject");
            }

            //操作组件的子组件
            var new_delete_a = document.createElement("a");
            new_delete_a.href = "#";
            new_delete_a.innerHTML = "删除 ";
            var new_accept_a = document.createElement("a");
            new_accept_a.href = "#";
            new_accept_a.innerHTML = "通过 ";
            var new_download_a = document.createElement("a");
            new_download_a.href = "#";
            new_download_a.innerHTML = "下载压缩包 ";

            //把子组件都放在操作组件里面
            new_operation_td.appendChild(new_delete_a);
            new_operation_td.appendChild(new_accept_a);
            new_operation_td.appendChild(new_download_a);

            new_tr.appendChild(new_id_td);
            new_tr.appendChild(new_username_td);
            new_tr.appendChild(new_gamename_td);
            new_tr.appendChild(new_version_td);
            new_tr.appendChild(new_timestamps_td);
            new_tr.appendChild(new_status_td);
            new_tr.appendChild(new_operation_td);

            const_tbody.appendChild(new_tr);
        }

        message_table.appendChild(const_tbody);
    }

    function init() {
        // const select_production_message_api = "./../../backend/api/select_production_message_api.php";

        // //向接口获取用户名和游戏审核状态
        // const select_newgame_list_info_by_newgame_id_api = "./../../backend/api/select_newgame_list_info_by_newgame_id_api.php";
        // var form_data = new FormData();
        // form_data.append("recognize_id", recognize_ids[i]);
        // fetch(select_newgame_list_info_by_newgame_id_api, {
        //     method: "POST",
        //     body: form_data
        // })
        //     .then(response => response.json())
        //     .then(data => {
        //         if (data.code != 0) {
        //             alert(data.msg);
        //         }
        //         else {
        //             console.log("查询游戏资讯成功");
        //             console.log(data.data);
        //             new_username_td.innerHTML = data.data.username; //不放在这里又会被异步优化掉,username直接为空
        //             new_gamename_td.innerHTML = data.data.newgame_name;
        //             new_version_td.innerHTML = data.data.version + 1 + ".0";
        //             if (data.data.status == 0) {
        //                 new_status_td.innerHTML = "待审核";
        //                 new_status_td.classList.add("my-not-read");
        //             }
        //             else if (data.data.status == 1) {
        //                 new_status_td.innerHTML = "已通过";
        //                 new_status_td.classList.add("my-accept");
        //             }
        //             else if (data.data.status == 2) {
        //                 new_status_id.innerHTML = "已驳回";
        //                 new_status_td.classList.add("my-reject");
        //             }
        //             fetch(select_production_message_api, {
        //                 method: "GET"
        //             })
        //                 .then(response => response.json())
        //                 .then(data => {
        //                     if (data.code != 0) {
        //                         alert(data.msg);
        //                     }
        //                     else {
        //                         console.log("全部消息查询成功");
        //                         console.log(data.dada);
        //                         if (data.data.accountnumbers.length == 0) {
        //                             generateEmptyTable("消息列表为空");
        //                         }
        //                         else {
        //                             var message_ids = data.data.message_ids;
        //                             var accountnumbers = data.data.accountnumbers;
        //                             var message_titles = data.data.message_titles;
        //                             var timestamps = data.data.timestamps;
        //                             var message_status = data.data.message_status;
        //                             var recognize_ids = data.data.recognize_ids;
        //                             console.log(data.data);
        //                             generateMessageTable(accountnumbers, message_titles, timestamps, message_status, recognize_ids);
        //                         }
        //                     }
        //                 })
        //                 .catch(error => console.error(error))
        //         }
        //     })
        //     .catch(error => console.error(error))

        const select_root_message_info_api = "./../../backend/api/select_root_message_info_api.php";
        fetch(select_root_message_info_api, {
            method: "GET"
        })
            .then(response => response.json())
            .then(data => {
                console.log(data);
                if (data.code != 0) {
                    alert(data.msg);
                } else {
                    console.log("管理员消息中心资料请求成功");
                    var timestampss = data.data.timestampss;
                    var statuss = data.data.statuss;
                    var usernames = data.data.usernames;
                    var newgame_names = data.data.newgame_names;
                    var versions = data.data.versions;
                    generateMessageTable(timestampss, statuss, usernames, newgame_names, versions);
                }
            })
            .catch(error => console.error(error));
    }

    window.onload = init();
</script>

</html>